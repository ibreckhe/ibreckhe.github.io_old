<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[TinyPlant]]></title>
  <link href="http://ibreckhe.github.io/atom.xml" rel="self"/>
  <link href="http://ibreckhe.github.io/"/>
  <updated>2015-03-17T10:50:59-07:00</updated>
  <id>http://ibreckhe.github.io/</id>
  <author>
    <name><![CDATA[Ian Breckheimer]]></name>
    <email><![CDATA[ibreckhe@uw.edu]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Easy Web Maps With R and Leaflet]]></title>
    <link href="http://ibreckhe.github.io/blog/2015/03/16/leaflet-maps/"/>
    <updated>2015-03-16T02:00:00-07:00</updated>
    <id>http://ibreckhe.github.io/blog/2015/03/16/leaflet-maps</id>
    <content type="html"><![CDATA[<p>I’ve been using R as a de-facto Geographic Information System (GIS) for a long time, and I’ve relied heavily on the excellent rgdal, Maptools, and raster packages to process spatial data.  One thing has always bugged me about this workflow, however. If I want to check or explore geographic data by clicking around on a map, I nearly always have to export it and open it up in another program like ArcGIS or QGIS. That’s why I was really excited to learn that the folks at Rstudio have come up with a cool solution: they’ve written R wrappers for the leaflet javascript library which allows folks to quickly overlay vector data on an interactive web map that allows you to pan and zoom. In this post I’ll describe how to make a simple map that you can use to explore data, or post to the web.</p>

<!-- more -->

<p>If you are using Rstudio, then this map appears alongside your code
This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com">http://rmarkdown.rstudio.com</a>.</p>

<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>

<pre><code>summary(cars)

##      speed           dist       
##  Min.   : 4.0   Min.   :  2.00  
##  1st Qu.:12.0   1st Qu.: 26.00  
##  Median :15.0   Median : 36.00  
##  Mean   :15.4   Mean   : 42.98  
##  3rd Qu.:19.0   3rd Qu.: 56.00  
##  Max.   :25.0   Max.   :120.00
</code></pre>

<p>You can also embed plots, for example:</p>

<p><img src="http://ibreckhe.github.io/images/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /> </p>

<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Phenology and the Intersection of Two Curves]]></title>
    <link href="http://ibreckhe.github.io/blog/2014/07/19/curve-overlap/"/>
    <updated>2014-07-19T02:00:00-07:00</updated>
    <id>http://ibreckhe.github.io/blog/2014/07/19/curve-overlap</id>
    <content type="html"><![CDATA[<p>My lab has been working on a project forecasting how the timing of flowering will vary over space and through time with climate change. To do this well, we need robust ways to quantify shifts in phenological timing. The approach we have taken so-far is to fit relatively simple functions to the observed data, but how do we quantify the amount of shift? Here’s where numerical integration comes in. Here’s an example with some simulated data. I’ve borrowed some of this code from <a href="http://stats.stackexchange.com/questions/12209/percentage-of-overlapping-regions-of-two-normal-distributions">here</a>.</p>

<!-- more -->

<p><img src="http://ibreckhe.github.io/images/Rainier_Meadow.JPG" alt="Rainier Meadow" /></p>

<p>First we define the two functions representing the two phenological curves from different species, times, or places. In this case, the curves are quasi-gaussian, with functional forms we can easily fit using logistic regression.</p>

<pre><code>f1 &lt;- function(x,a1,b1,c1) { exp(a1 + b1 * x + c1 * x^2)/(1 + exp(a1 + b1 * x + c1 * x^2)) }
f2 &lt;- function(x,a2,b2,c2) { exp(a2 + b2 * log(x) + c2 * log(x)^2)/(1 + exp(a2 + b2 * log(x) + c2 * log(x)^2)) }
</code></pre>

<p>Next we want to convert the two functions into density functions (meaning that areas under the curves should sum to one). I’m doing this numerically to avoid a nasty integral. This works well unless the areas under the curve are really small.</p>

<pre><code>f1_dens &lt;- function(x,a1,b1,c1) { 
  y &lt;- f1(x,a1,b1,c1)
  yi &lt;- integrate(f1, -Inf, +Inf, a1=a1, b1=b1, c1=c1)
  return(y/yi[[1]])
}
 
f2_dens &lt;- function(x,a2,b2,c2) { 
  y &lt;- f2(x,a2,b2,c2)
  yi &lt;- integrate(f2, 1e-10, +Inf, a2=a2, b2=b2, c2=c2)
  return(y/yi[[1]])
}
</code></pre>

<p>Now we can define a function that returns the minimum of the two curves wherever they overlap.</p>

<pre><code>min_f1f2_dens &lt;- function(x, a1, b1, c1, a2, b2, c2) {
  f1 &lt;- f1_dens(x,a1,b1,c1) 
  f2 &lt;- f2_dens(x,a2,b2,c2)
  pmin(f1, f2)
}
</code></pre>

<p>Now we can use some made-up parameters for each curve and plot them.</p>

<pre><code>a1 &lt;- -65
b1 &lt;- 40
c1 &lt;- -6
 
a2 &lt;- -2
b2 &lt;- 7
c2 &lt;- -6
xs &lt;- seq(0.0001,5,by=0.01)
 
y1s &lt;- f1(xs,a1,b1,c1)
y2s &lt;- f2(xs,a2,b2,c2)
y1d &lt;- f1_dens(xs,a1,b1,c1)
y2d &lt;- f2_dens(xs,a2,b2,c2)
 
yid &lt;- min_f1f2_dens(xs, a1, b1, c1, a2, b2, c2)
xpd &lt;- c(xs, xs[1])
ypd &lt;- c(yid, yid[1])
 
par(mfrow=c(1,1))
plot(xs, y1s, type="n", ylim=c(0, max(y1d,y2d)),xlab="Time", ylab="Flowering Density")
lines(xs, y1d, lty="solid")
lines(xs, y2d, lty="dotted")
</code></pre>

<p><img src="http://ibreckhe.github.io/images/figure/unnamed-chunk-4.png" alt="plot of chunk unnamed-chunk-4" /> </p>

<p>The last step is to compute the area where the two curves intersect.</p>

<pre><code>##Computes overlap
over_dens &lt;- integrate(min_f1f2_dens, 0, Inf, a1=a1, b1=b1, c1=c1, a2=a2, b2=b2, c2=c2)
</code></pre>

<p>Finally we can plot everything to make sure it makes sense.</p>

<pre><code>par(mfrow=c(1,1))
plot(xs, y1s, type="n", ylim=c(0, max(y1d,y2d)),xlab="x", ylab="Density")
polygon(xpd, ypd, col="gray")
lines(xs, y1d, lty="solid")
lines(xs, y2d, lty="dotted")
title(main=paste("Overlap: ",round(over_dens[[1]],2)))
</code></pre>

<p><img src="http://ibreckhe.github.io/images/figure/unnamed-chunk-6.png" alt="plot of chunk unnamed-chunk-6" /> </p>

<p>There are some analytical ways to do this for polynomial and Gaussian functions, but this approach is agnostic about what the functional form of the phenology curves are, so long as they have a finite integral.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Adding Rich R Content]]></title>
    <link href="http://ibreckhe.github.io/blog/2014/07/18/report-template/"/>
    <updated>2014-07-18T00:00:00-07:00</updated>
    <id>http://ibreckhe.github.io/blog/2014/07/18/report-template</id>
    <content type="html"><![CDATA[<p>With a bit of tweaking, you can create rich documents with R markdown that combine text, figures, equations and tables that are generated by R on the fly. Now if only blogs could get a DOI…</p>

<!-- more -->

<p><strong>Tables:</strong></p>

<p>Tables can be used with the knitr::kable function.</p>
<table>
 <thead>
  <tr>
   <th align="left">   </th>
   <th align="center"> mpg </th>
   <th align="center"> cyl </th>
   <th align="center"> disp </th>
   <th align="center"> hp </th>
   <th align="center"> drat </th>
   <th align="center"> wt </th>
   <th align="center"> qsec </th>
   <th align="center"> vs </th>
   <th align="center"> am </th>
   <th align="center"> gear </th>
   <th align="center"> carb </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td align="left"> Mazda RX4 </td>
   <td align="center"> 21.0 </td>
   <td align="center"> 6 </td>
   <td align="center"> 160 </td>
   <td align="center"> 110 </td>
   <td align="center"> 3.90 </td>
   <td align="center"> 2.620 </td>
   <td align="center"> 16.46 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
   <td align="center"> 4 </td>
   <td align="center"> 4 </td>
  </tr>
  <tr>
   <td align="left"> Mazda RX4 Wag </td>
   <td align="center"> 21.0 </td>
   <td align="center"> 6 </td>
   <td align="center"> 160 </td>
   <td align="center"> 110 </td>
   <td align="center"> 3.90 </td>
   <td align="center"> 2.875 </td>
   <td align="center"> 17.02 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
   <td align="center"> 4 </td>
   <td align="center"> 4 </td>
  </tr>
  <tr>
   <td align="left"> Datsun 710 </td>
   <td align="center"> 22.8 </td>
   <td align="center"> 4 </td>
   <td align="center"> 108 </td>
   <td align="center"> 93 </td>
   <td align="center"> 3.85 </td>
   <td align="center"> 2.320 </td>
   <td align="center"> 18.61 </td>
   <td align="center"> 1 </td>
   <td align="center"> 1 </td>
   <td align="center"> 4 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> Hornet 4 Drive </td>
   <td align="center"> 21.4 </td>
   <td align="center"> 6 </td>
   <td align="center"> 258 </td>
   <td align="center"> 110 </td>
   <td align="center"> 3.08 </td>
   <td align="center"> 3.215 </td>
   <td align="center"> 19.44 </td>
   <td align="center"> 1 </td>
   <td align="center"> 0 </td>
   <td align="center"> 3 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> Hornet Sportabout </td>
   <td align="center"> 18.7 </td>
   <td align="center"> 8 </td>
   <td align="center"> 360 </td>
   <td align="center"> 175 </td>
   <td align="center"> 3.15 </td>
   <td align="center"> 3.440 </td>
   <td align="center"> 17.02 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 3 </td>
   <td align="center"> 2 </td>
  </tr>
</tbody>
</table>

<p><strong>Math</strong></p>

<p>Equations are handled in LATEX format by MathJax:
<script type="math/tex">\frac{1}{n} \sum_{i=i}^{n} x_{i}</script></p>

<p><strong>Embedded Images:</strong></p>

<p>Links to websites can be included <a href="http://www.google.com">like this</a>.</p>

<p>Embedding images with control over the size and resolution is a bit tricky. I like to import my PNG images as R objects, that way they are treated like any other plot.</p>

<p><img src="http://ibreckhe.github.io/images/figure/unnamed-chunk-2.png" title="This is also a caption." alt="This is also a caption." style="display: block; margin: auto;" /></p>

<p><strong>Citations:</strong></p>

<p>It is also straightforward to include inline citations like this using the package <code>knitcitations</code> package (<span title="Abrams P, Ruokolainen L, Shuter B and McCann K (2012). 'Harvesting Creates Ecological Traps: Consequences of Invisible Mortality Risks in Predator–Prey Metacommunities.' Ecology, 93, pp. 281-293. ISSN 0012-9658."><a href="http://dx.doi.org/10.1890/11-0011.1">Abrams et al. (2012)</a></span>; <span title="Bolnick D, Ingram T, Stutz W, Snowberg L, Lau O and Paull J (2010). 'Ecological Release From Interspecific Competition Leads to Decoupled Changes in Population And Individual Niche Width.' Proceedings of The Royal Society B: Biological Sciences, 277, pp. 1789-1797. ISSN 0962-8452."><a href="http://dx.doi.org/10.1098/rspb.2010.0018">Bolnick et al. (2010)</a></span>).</p>

<p>And include a dynamically generated list of references:</p>

<p><strong>Works Cited:</strong></p>

<ul>
  <li>Peter A. Abrams, Lasse Ruokolainen, Brian J. Shuter, Kevin S. McCann,   (2012) Harvesting Creates Ecological Traps: Consequences of Invisible Mortality Risks in Predator–Prey Metacommunities.  <em>Ecology</em>  <strong>93</strong>  281-293  <a href="http://dx.doi.org/10.1890/11-0011.1">10.1890/11-0011.1</a></li>
  <li>D. I. Bolnick, T. Ingram, W. E. Stutz, L. K. Snowberg, O. L. Lau, J. S. Paull,   (2010) Ecological Release From Interspecific Competition Leads to Decoupled Changes in Population And Individual Niche Width.  <em>Proceedings of The Royal Society B: Biological Sciences</em>  <strong>277</strong>  1789-1797  <a href="http://dx.doi.org/10.1098/rspb.2010.0018">10.1098/rspb.2010.0018</a></li>
</ul>

<p><em>Source code for this document is available <a href="https://github.com/ibreckhe/code/blob/master/report_template.Rmd">here</a></em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hello World]]></title>
    <link href="http://ibreckhe.github.io/blog/2014/07/18/hello-world/"/>
    <updated>2014-07-18T00:00:00-07:00</updated>
    <id>http://ibreckhe.github.io/blog/2014/07/18/hello-world</id>
    <content type="html"><![CDATA[<p>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com">http://rmarkdown.rstudio.com</a>.</p>

<!-- more -->

<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>

<pre><code>summary(cars)

##      speed           dist    
##  Min.   : 4.0   Min.   :  2  
##  1st Qu.:12.0   1st Qu.: 26  
##  Median :15.0   Median : 36  
##  Mean   :15.4   Mean   : 43  
##  3rd Qu.:19.0   3rd Qu.: 56  
##  Max.   :25.0   Max.   :120
</code></pre>

<p>You can also embed plots, for example:</p>

<p><img src="http://ibreckhe.github.io/images/figure/unnamed-chunk-2.png" alt="plot of chunk unnamed-chunk-2" /> </p>

<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
]]></content>
  </entry>
  
</feed>
